<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js"></script>
</head>

<body>
    <textarea id="code" style="width: 100%;" rows="6" ></textarea>
    <button onclick="evaluatePython()">Run</button>
    <br />
    <br />
    <div>Output:</div>
    <textarea id="output" style="width: 100%;" rows="6" disabled></textarea>

    <script>
        const testcasemaker=`import os
import sys
from unittest import result
os.makedirs("./answer",exist_ok=True)
judge=[]
try:
    test_file_name=sys.argv[1]
except IndexError:
    print("テストを実行したいファイルを選択してください")
for ans_file_num in range(10):
    #入出力のポインタを取得
    input_file=open(f"./testcase/{ans_file_num:04}_in.txt","r")
    output_file=open(f"./answer/{ans_file_num:04}_ans.txt","w")
    sys.stdin=input_file
    sys.stdout=output_file
    with open(test_file_name,"r")as f:
        exec(f.read())
    input_file.close()
    output_file.close()

    with open(f"./answer/{ans_file_num:04}_ans.txt","r")as f1:
        with open(f"./testcase/{ans_file_num:04}_out.txt","r")as f2:
            ans=f1.readlines()
            fans=[out[:-1] for out in ans if out[0]!="#"]
            inp=f2.readlines()
            finp=[out[:-1] for out in inp]

            sys.stdout=sys.__stdout__

            if len(fans)!=len(finp):
                judge.append("WA")
                continue
            for fan,fin in zip(fans,finp):
                if fan!=fin:
                    judge.append("WA")
                    break
            else:
                judge.append("AC")
            
     
with open("result.txt","w")as f:
    f.readlines(result)
`
        const tester=`import os
import sys
from unittest import result
os.makedirs("./answer",exist_ok=True)
judge=[]
try:
    test_file_name=sys.argv[1]
except IndexError:
    print("テストを実行したいファイルを選択してください")
for ans_file_num in range(10):
    #入出力のポインタを取得
    input_file=open(f"./testcase/{ans_file_num:04}_in.txt","r")
    output_file=open(f"./answer/{ans_file_num:04}_ans.txt","w")
    sys.stdin=input_file
    sys.stdout=output_file
    with open(test_file_name,"r")as f:
        exec(f.read())
    input_file.close()
    output_file.close()

    with open(f"./answer/{ans_file_num:04}_ans.txt","r")as f1:
        with open(f"./testcase/{ans_file_num:04}_out.txt","r")as f2:
            ans=f1.readlines()
            fans=[out[:-1] for out in ans if out[0]!="#"]
            inp=f2.readlines()
            finp=[out[:-1] for out in inp]

            sys.stdout=sys.__stdout__

            if len(fans)!=len(finp):
                judge.append("WA")
                continue
            for fan,fin in zip(fans,finp):
                if fan!=fin:
                    judge.append("WA")
                    break
            else:
                judge.append("AC")
            
     
with open("result.txt","w")as f:
    f.readlines(judge)

            

        
`


        const output = document.getElementById("output");
        const code = document.getElementById("code");

        function addToOutput(s) {
            output.value += ">>>" + code.value + "\n" + s + "\n";
        }

        output.value = "Initializing...\n";
        // init Pyodide
        async function main() {
            let pyodide = await loadPyodide();
            pyodide.runPython(testcasemaker)

            output.value += "Ready!\n";
            return pyodide;
        }
        let pyodideReadyPromise = main();

        async function evaluatePython() {
            let pyodide = await pyodideReadyPromise;
            try {
                pyodide.runPython(
`with open("submission.py","r")as f:
    f.write("""`+code.value+`""")`);
                pyodide.runPython(`
with open("result.txt","r")as f:
    res=0
    case=0
    for c in f.readlines():
        if c[:-1]=="AC":
            res+=1
        case+=0`)
                let output=pyodide.runPython(`f"{res}/{case}:{["WA","AC"][res==case]}"`)
                addToOutput(output);
            } catch (err) {
                addToOutput(err);
            }
        }
    </script>
</body>

</html>